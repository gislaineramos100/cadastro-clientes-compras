<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/style.css">
    <title>Clientes</title>
</head>
<body class="caixa-alta">
    <nav class="navbar">
        <a href="index.html">üè† MENU</a>
        <a href="clientes.html">üë• CLIENTES</a>
        <a href="compras.html">üõí NOVA COMPRA</a>
        <a href="login.html" onclick="localStorage.clear()" style="color:red; margin-left:auto;">SAIR</a>
    </nav>

    <div class="container">
        <h2>CADASTRAR CLIENTE</h2>
        <div class="grid">
            <input type="text" id="nome" placeholder="NOME COMPLETO">
            <input type="text" id="cpf" placeholder="CPF">
            <input type="text" id="tel" placeholder="TELEFONE">
            <input type="email" id="email" placeholder="E-MAIL" style="text-transform: none;"> <input type="text" id="endereco" placeholder="ENDERE√áO COMPLETO" style="grid-column: span 2;">
        </div>
        <button onclick="salvarCliente()" style="width: 100%">GRAVAR CLIENTE</button>

        <hr>
        <h2>PESQUISAR CLIENTE</h2>
        <input type="text" id="buscaCpf" placeholder="DIGITE O CPF PARA LOCALIZAR..." onkeyup="buscar()" style="width: 100%; margin-bottom: 20px;">

        <table>
            <thead><tr><th>CPF</th><th>NOME</th><th>A√á√ÉO</th></tr></thead>
            <tbody id="lista"></tbody>
        </table>
    </div>

    <script>
        let todosClientes = [];
        async function salvarCliente() {
            const data = {
                nome: document.getElementById('nome').value.toUpperCase(),
                cpf: document.getElementById('cpf').value,
                tel: document.getElementById('tel').value,
                email: document.getElementById('email').value,
                endereco: document.getElementById('endereco').value.toUpperCase()
            };
            await fetch('/api/clientes', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            location.reload();
        }

        async function carregar() {
            const res = await fetch('/api/clientes');
            todosClientes = await res.json();
            renderizar(todosClientes);
        }

        function renderizar(lista) {
            document.getElementById('lista').innerHTML = lista.map(c => `
                <tr>
                    <td>${c.cpf}</td>
                    <td>${c.nome}</td>
                    <td><button onclick="window.location.href='cliente.html?cpf=${c.cpf}'">VER FICHA</button></td>
                </tr>
            `).join('');
        }

        function buscar() {
            const termo = document.getElementById('buscaCpf').value.toUpperCase();
            const filtrados = todosClientes.filter(c => c.cpf.includes(termo) || c.nome.includes(termo));
            renderizar(filtrados);
        }
        carregar();
    </script>
</body>
</html>